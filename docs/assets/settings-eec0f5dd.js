import{v as e,h as s,$ as t,T as a}from"./index-81412148.js";import{c as o,$ as l}from"./dialog-aabe9f9e.js";const{div:n,h4:c,p:i,button:r,input:u}=e.tags,d=()=>{let d=e.state(!1),p=e.state(!1);function f(){o({title:"Overwrite confirmation?",message:"Are you sure you want to restore from this backup? This cannot be undone.",type:"yesno"}).then(e=>{if(e){const e=document.getElementById("file");e.onchange=()=>{e&&e.files&&[...e.files].forEach(e=>{"application/json"==e.type&&function(e){const s=new FileReader;s.addEventListener("load",e=>{const s=e.target.result;if(s&&"string"==typeof s){p.val=!0;let e=JSON.parse(s),o=new Array;e.transaction.forEach(e=>{let s=new a(e);s.id=0,o.push(s)}),o.length>0&&t.transaction.importTransactions(o),e.rules.length>0&&t.tag.importRules(e.rules),e.tags.length>0&&t.tag.importTags(e.tags),p.val=!1,l({message:"Database restored successful",type:"success"})}}),s.readAsText(e)}(e)})},e.click()}})}return n({class:"columns"},n({class:"column is-one-fifth"},c({class:"title is-4"},"Backup / Restore")),n({class:"column"},n({style:"border-left: 2px solid; padding-left: 10px;"},i("Export the entire database to create a backup."),r({class:"button is-default",disabled:()=>d.val,onclick:()=>(d.val=!0,void t.dashboard.getAllTransactions().then(e=>{if(200===e){let e={transaction:t.dashboard.transactions.val,rules:t.tag.rules.val,tags:t.tag.tags.val},s=JSON.stringify(e);const a=new Blob([s],{type:"text/plain"}),o=document.createElement("a");o.href=window.URL.createObjectURL(a),o.download=`budget-backup_${(new Date).toISOString()}.json`,o.click(),d.val=!1}}))},()=>d.val?s():"Backup"),i("Restore database from a backup."),r({class:"button is-default",disabled:()=>p.val,onclick:()=>f()},()=>p.val?s():"Restore"),u({type:"file",name:"files[]",id:"file",style:"opacity: 0",multiple:""}))))},{div:p,h4:f,p:m,button:b,input:y,label:g,br:h}=e.tags,k=()=>{let a=e.state(!1),o=e.state(0);return p({class:"columns"},p({class:"column is-one-fifth"},f({class:"title is-4"},"Tag Rule")),p({class:"column"},p({style:"border-left: 2px solid; padding-left: 10px;"},m("Start the tag generator."),p({class:"control"},g({class:"radio"},y({type:"radio",name:"runType",class:"radio",checked:()=>0===o.val,onclick:()=>o.val=0}),"Blanks only"),h(),g({class:"radio"},y({type:"radio",name:"runType",class:"radio",checked:()=>1===o.val,onclick:()=>o.val=1}),"All records")),b({class:"button",disabled:()=>a.val,onclick:()=>(a.val=!0,void t.dashboard.getAllTransactions().then(e=>{if(200===e){let e=new Array;0===o.val?t.dashboard.transactions.val.filter(e=>null==e.tag||""==e.tag).forEach(s=>{s.tag=t.tag.generateTag(s),e.push(s)}):1===o.val&&t.dashboard.transactions.val.forEach(s=>{s.tag=t.tag.generateTag(s),e.push(s)}),e.length>0?t.transaction.saveTransactions(e).then(e=>{200===e&&(a.val=!1,l({type:"success",message:"Completed successful."}))}):(a.val=!1,l({type:"info",message:"No transactions found."}))}}))},()=>a.val?s():"Run Rules"))))},{div:w,h4:R,p:x,button:v}=e.tags,{div:T}=e.tags,A=()=>T({class:"container mt-2"},d(),k(),(()=>{let a=e.state(!1);return w({class:"columns"},w({class:"column is-one-fifth"},R({class:"title is-4"},"Reset")),w({class:"column"},w({style:"border-left: 2px solid; padding-left: 10px;"},x("Reset the database to a clean slate. Make sure you have a backup!"),v({class:"button is-danger",disabled:()=>a.val,onclick:()=>{o({title:"Reset confirmation?",message:"Are you sure you want to reset the database? This cannot be undone.",type:"yesno"}).then(e=>{e&&(a.val=!0,Promise.all([t.transaction.resetTansactions(),t.tag.resetAll()]).then(()=>{a.val=!1,l({type:"success",message:"Database reset successful."})}))})}},()=>a.val?s():"Reset"))))})());export{A as Settings};
