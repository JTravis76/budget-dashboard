import{v as e,h as s,$ as t,T as a,i as l,j as o,k as n}from"./index-d25e61ad.js";import{c,$ as i}from"./dialog-47ec0b44.js";import{e as r}from"./event-emitter-eaaf34fa.js";const u=()=>{const{div:l,h4:o,p:n,button:r,input:u}=e.tags;let d=e.state(!1),p=e.state(!1);function f(){c({title:"Overwrite confirmation?",message:"Are you sure you want to restore from this backup? This cannot be undone.",type:"yesno"}).then(e=>{if(e){const e=document.getElementById("file");e.onchange=()=>{e&&e.files&&[...e.files].forEach(e=>{"application/json"==e.type&&function(e){const s=new FileReader;s.addEventListener("load",e=>{const s=e.target.result;if(s&&"string"==typeof s){p.val=!0;let e=JSON.parse(s),l=new Array;e.transaction.forEach(e=>{let s=new a(e);s.id=0,l.push(s)}),l.length>0&&t.transaction.importTransactions(l),e.rules.length>0&&t.tag.importRules(e.rules),e.tags.length>0&&t.tag.importTags(e.tags),p.val=!1,i({message:"Database restored successful",type:"success"})}}),s.readAsText(e)}(e)})},e.click()}})}return l({class:"columns"},l({class:"column is-one-fifth"},o({class:"title is-4"},"Backup / Restore")),l({class:"column"},l({style:"border-left: 2px solid; padding-left: 10px;"},n("Export the entire database to create a backup."),r({class:"button is-default",disabled:()=>d.val,onclick:()=>(d.val=!0,void t.dashboard.getAllTransactions().then(e=>{if(200===e){let e={transaction:t.dashboard.transactions.val,rules:t.tag.rules.val,tags:t.tag.tags.val},s=JSON.stringify(e);const a=new Blob([s],{type:"text/plain"}),l=document.createElement("a");l.href=window.URL.createObjectURL(a),l.download=`budget-backup_${(new Date).toISOString()}.json`,l.click(),d.val=!1}}))},()=>d.val?s():"Backup"),n("Restore database from a backup."),r({class:"button is-default",disabled:()=>p.val,onclick:()=>f()},()=>p.val?s():"Restore"),u({type:"file",name:"files[]",id:"file",style:"opacity: 0",multiple:""}))))},d=()=>{const{div:a,h4:l,p:o,button:n,input:c,label:r,br:u}=e.tags;let d=e.state(!1),p=e.state(0);return a({class:"columns"},a({class:"column is-one-fifth"},l({class:"title is-4"},"Tag Rule")),a({class:"column"},a({style:"border-left: 2px solid; padding-left: 10px;"},o("Start the tag generator."),a({class:"control"},r({class:"radio"},c({type:"radio",name:"runType",class:"radio",checked:()=>0===p.val,onclick:()=>p.val=0}),"Blanks only"),u(),r({class:"radio"},c({type:"radio",name:"runType",class:"radio",checked:()=>1===p.val,onclick:()=>p.val=1}),"All records")),n({class:"button",disabled:()=>d.val,onclick:()=>(d.val=!0,void t.dashboard.getAllTransactions().then(e=>{if(200===e){let e=new Array;0===p.val?t.dashboard.transactions.val.filter(e=>null==e.tag||""==e.tag).forEach(s=>{s.tag=t.tag.generateTag(s),e.push(s)}):1===p.val&&t.dashboard.transactions.val.forEach(s=>{s.tag=t.tag.generateTag(s),e.push(s)}),e.length>0?t.transaction.saveTransactions(e).then(e=>{200===e&&(d.val=!1,i({type:"success",message:"Completed successful."}))}):(d.val=!1,i({type:"info",message:"No transactions found."}))}}))},()=>d.val?s():"Run Rules"))))},p=()=>{const{div:s,h4:a}=e.tags;let c=t.user.profile.val;return r.subscribe("toggle",e=>{l(e),c.darkTheme=e,t.user.saveUser(c)}),s({class:"columns"},s({class:"column is-one-fifth"},a({class:"title is-4"},"Theme")),s({class:"column"},s({style:"border-left: 2px solid; padding-left: 10px;"},(s=>{const{div:t,input:a,label:l}=e.tags;let o=e.state(null==s?void 0:s.state);return t({class:"toggle-switch--container"},t((null==s?void 0:s.offLabel)??"Off"),a({type:"checkbox",id:(null==s?void 0:s.id)??"sw-1",name:(null==s?void 0:s.id)??"sw-1",checked:()=>o.val,onchange:e=>{o.val=e.target.checked,r.emit("toggle",o.val)}}),l({for:(null==s?void 0:s.id)??"sw-1"}),t((null==s?void 0:s.onLabel)??"On"))})({id:"sw-1",offLabel:o(),onLabel:n(),state:c.darkTheme}))))},f=()=>{const{div:a}=e.tags;return a({class:"container mt-2"},p(),u(),d(),(()=>{const{div:a,h4:l,p:o,button:n}=e.tags;let r=e.state(!1);return a({class:"columns"},a({class:"column is-one-fifth"},l({class:"title is-4"},"Reset")),a({class:"column"},a({style:"border-left: 2px solid; padding-left: 10px;"},o("Reset the database to a clean slate. Make sure you have a backup!"),n({class:"button is-danger",disabled:()=>r.val,onclick:()=>{c({title:"Reset confirmation?",message:"Are you sure you want to reset the database? This cannot be undone.",type:"yesno"}).then(e=>{e&&(r.val=!0,Promise.all([t.transaction.resetTansactions(),t.tag.resetAll()]).then(()=>{r.val=!1,i({type:"success",message:"Database reset successful."})}))})}},()=>r.val?s():"Reset"))))})())};export{f as Settings};
