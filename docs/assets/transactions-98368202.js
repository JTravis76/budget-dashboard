var s=Object.defineProperty,t=(t,a,e)=>(((t,a,e)=>{a in t?s(t,a,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[a]=e})(t,"symbol"!=typeof a?a+"":a,e),e);import{v as a,S as e,$ as n,T as o,a as l,b as c,c as i}from"./index-383cc3b0.js";import{e as r}from"./event-emitter-eaaf34fa.js";import{c as d}from"./dialog-28a53218.js";class p{constructor(s){t(this,"page"),t(this,"pagesize"),t(this,"total"),this.page=1,this.pagesize=25,this.total=1,s&&Object.assign(this,s)}}const{div:u,label:m,input:g,button:b,small:f,form:h,select:v,option:y}=a.tags,{tags:w}=n.tag,k=a.state(!1);let z=new e;let x=v({class:"input",onchange:s=>z.tag=s.target.value},y({value:""},""));a.derive(()=>{let s=new Array;s=w.val.map(s=>y({value:s},s)),a.add(x,s)});const _=()=>u({class:"box"},h(u({class:"is-pulled-right"},b({type:"button",onclick:()=>k.val=!k.val},f("Advance search"))),u({class:"is-clearfix"}),u({class:"columns"},u({class:"column"},u({class:"field"},m({class:"field"},"Search"),u({class:"control"},g({class:"input",type:"text",placeholder:"Search..",oninput:s=>z.search=s.target.value})))),u({class:"column"},u({class:"field"},m({class:"field"},"Tags"),u({class:"control"},x)))),u({class:()=>k.val?"columns":"is-hidden"},u({class:"column"},m({class:"field"},"Date From"),g({class:"input",type:"date",onblur:s=>z.date.start=s.target.value})),u({class:"column"},m({class:"field"},"Date To"),g({class:"input",type:"date",onblur:s=>z.date.end=s.target.value})),u({class:"column"},m({class:"field"},"Amount"),g({class:"input",type:"number",placeholder:"start",oninput:s=>z.amount.start=s.target.value})),u({class:"column"},m({class:"field"},"Amount"),g({class:"input",type:"number",placeholder:"end",oninput:s=>z.amount.end=s.target.value}))),u({class:"buttons"},b({class:"button is-primary",type:"button",onclick:()=>r.emit("search",z)},"Apply"),b({class:"button is-secondary",type:"reset",onclick:()=>{z=new e}},"Reset")))),A={open(s){const t=document.getElementById(s);t&&t.classList.add("is-active")},close(s){const t=document.getElementById(s);t&&t.classList.remove("is-active")},toggle(s){const t=document.getElementById(s);t&&t.classList.toggle("is-active")}},{div:T,header:M,p:S,section:j,footer:D,button:I}=a.tags,C=(s,t)=>{const a=()=>A.close(s.id);return T({id:s.id,class:"modal"},T({class:"modal-background"}),T({class:"modal-card"},M({class:"modal-card-head"},S({class:"modal-card-title"},s.title),I({class:"delete",ariaLabel:"close",onclick:a})),j({class:"modal-card-body"},t),()=>s.footer?D({class:"modal-card-foot"},T({class:"buttons"},I({class:"button is-success",onclick:()=>r.emit("action")},"Save"),I({class:"button",onclick:a},"Cancel"))):T()))},{div:F,label:E,input:L,select:N,option:$}=a.tags,{transaction:O}=n.transaction,{tags:R}=n.tag;r.subscribe("action",function(){n.transaction.saveTransaction().then(()=>{A.close("TransactionModal"),O.val=new o})});let P=N({class:"input",onchange:s=>O.val.tag=s.target.value},$({value:""},""));a.derive(()=>{let s=new Array;s=R.val.map(s=>$({value:s,selected:()=>O.val.tag===s},s)),a.add(P,s)});const{div:U,input:V,label:q,span:B,strong:G}=a.tags,H=()=>{function s(s){s.preventDefault(),s.stopPropagation(),document.getElementsByClassName("dropzone")[0].classList.remove("is-dragover")}function t(s){const t=new FileReader;t.addEventListener("load",s=>{const t=s.target.result;if(t&&"string"==typeof t){let s=0,a=new Array;const e=new Array;t.split("\r\n").forEach(t=>{if(0===s)a=t.split(",");else{const s=t.replaceAll('"',"").split(",");let l=0;const c={};for(const t of a)c[t]=s[l],l+=1;c.amount=parseFloat(c.amount.toString());let i=new o(c);i.tag=n.tag.generateTag(i),i.dttm&&i.name&&e.push(i)}s+=1}),n.transaction.saveTransactions(e).then(s=>{200===s&&(document.getElementsByClassName("dropzone")[0].classList.remove("is-uploading"),document.getElementsByClassName("dropzone")[0].classList.add("is-success"),window.setTimeout(()=>window.location.reload(),1e3))})}}),t.readAsText(s)}return U({class:()=>window.FileReader?"dropzone has-advanced-upload":"dropzone",style:"text-align: center;",ondragover:s=>{s.preventDefault(),s.stopPropagation(),document.getElementsByClassName("dropzone")[0].classList.add("is-dragover")},ondrop:s=>function(s){s.preventDefault(),document.getElementsByClassName("dropzone")[0].classList.remove("is-dragover"),document.getElementsByClassName("dropzone")[0].classList.add("is-uploading"),s.dataTransfer&&s.dataTransfer.items?[...s.dataTransfer.items].forEach(s=>{if("file"===s.kind){const a=s.getAsFile();a&&t(a)}}):s.dataTransfer&&s.dataTransfer.files&&[...s.dataTransfer.files].forEach(s=>{t(s)})}(s),ondragend:t=>s(t),ondragleave:t=>s(t)},U({class:"dropzone__input"},l({class:"dropzone__icon"}),V({type:"file",name:"files[]",id:"file",class:"dropzone__file",multiple:"",onchange:()=>function(){const s=document.getElementById("file");s&&s.files&&[...s.files].forEach(s=>{"text/csv"==s.type&&t(s)})}()}),q({for:"file"},G("Choose a file"),B({class:"dropzone__dragndrop"}," or drag it here"),".")),U({class:"dropzone__uploading"},"Uploading..."),U({class:"dropzone__success"},"Done!"),U({class:"dropzone__error"},"Error"))},{div:J,a:K}=a.tags,{div:Q,table:W,thead:X,tbody:Y,tfoot:Z,tr:ss,th:ts,td:as,button:es,input:ns,select:os,option:ls,span:cs}=a.tags,{tags:is}=n.tag,{transaction:rs}=n.transaction;let ds=a.state(0),ps=a.state(0),us=a.state(0);function ms(){n.transaction.saveTransaction().then(()=>{ds.val=0})}const gs=s=>{us.val=0;const t=new Array;return s.transactions.forEach(s=>{us.val=us.val+parseFloat(s.amount.toString()),t.push(ss(as(Q({class:"buttons"},es({class:"button is-primary is-small is-outlined",onclick:()=>async function(s){rs.val=new o,s>0&&await n.transaction.getTransactionById(s),A.open("TransactionModal")}(s.id)},c({width:"16",height:"16"})),es({class:"button is-danger is-small is-outlined",onclick:()=>{var t;(t=s.id)>0&&d({title:"Confirm",message:"Are you sure you want to remove this transaction?",type:"yesno"}).then(s=>{s&&n.transaction.removeTransaction(t).then(()=>{window.location.reload()})})}},i({width:"16",height:"16"})))),as(Q({class:"text-nowrap"},s.dttm)),as(s.transaction),as(Q({style:"max-width:350px",class:"text-ellipsis",title:s.name},s.name)),as(()=>ds.val!=s.id?es({class:"button is-small",onclick:()=>{rs.val=s,ds.val=s.id}},s.memo):ns({type:"text",class:"input",value:()=>s.memo,oninput:t=>{s.memo=t.target.value,rs.val.memo=s.memo},onblur:()=>ms(),onkeyup:s=>{s.key.includes("Enter")&&ms()}})),as(s.amount),as(()=>ps.val!=s.id?es({class:"button is-small",onclick:()=>{rs.val=s,ps.val=s.id}},s.tag):os({class:"input",onblur:()=>ps.val=0,onchange:t=>{s.tag=t.target.value,rs.val.tag=s.tag,n.transaction.saveTransaction().then(()=>{ps.val=0})}},ls({value:""},""),is.val.map(t=>ls({value:t,selected:s.tag===t},t))))))}),Q({class:"columns"},Q({class:"column"},W({class:"table is-striped is-narrow is-fullwidth is-hoverable"},X(ss(ts(es({class:"button is-secondary is-small",onclick:()=>A.open("ImportModal")},"Import")),ts("Date"),ts("Transaction"),ts("Name"),ts("Memo"),ts("Amount"),ts("Tag"))),()=>0===s.transactions.length?Y(ss(as({colSpan:7},"No records found."))):Y(t),Z(ss(as({colSpan:5},""),as({colSpan:2},cs({class:"has-text-weight-bold"},"$",Math.abs(us.val).toFixed(2))))))),C({id:"TransactionModal",title:"Transaction Properties",footer:!0},F(F(E("Date"),L({type:"text",class:"input",disabled:!0,value:()=>O.val.dttm})),F(E("Transaction"),L({type:"text",class:"input",disabled:!0,value:()=>O.val.transaction})),F(E("Name"),L({type:"text",class:"input",disabled:!0,value:()=>O.val.name})),F(E("Memo"),L({type:"text",class:"input",placeholder:"Enter memo.",value:()=>O.val.memo,oninput:s=>O.val.memo=s.target.value})),F(E("Amount"),L({type:"text",class:"input",disabled:!0,value:()=>O.val.amount})),F(E("Tag"),P))),C({id:"ImportModal",title:"Import Transactions"},J(K({href:"./template.csv",traget:"_blank",class:"button is-small mb-4"},"CSV template"),H())))},{div:bs,nav:fs,ul:hs,li:vs,span:ys,a:ws,select:ks,option:zs}=a.tags;let xs=new e;const _s=s=>{const t=new p(s);let e=a.state(new Array);let n=a.state(1),o=a.state(t.total);if(o.val>3){let s=Math.ceil(1.5)-1,a=t.page-s,e=t.page+s;a<2?(e=3,a=1):e>t.total-2&&(e=t.total,a=t.total-3+1),n.val=a,o.val=e}e.val=[],n.val>2?(e.val.push(1),e.val.push(0)):n.val>1&&e.val.push(1);for(let a=n.val;a<=o.val;a++)e.val.push(a);return o.val<t.total&&(e.val.push(0),e.val.push(t.total)),bs({class:"mb-4"},bs({class:"is-pulled-right"},ks({class:"input",title:"page size",onchange:s=>{xs.page=1,xs.pagesize=parseInt(s.target.value,10),r.emit("page",xs)}},[25,50,100].map(t=>zs({selected:(null==s?void 0:s.pagesize)==t},t)))),fs({class:"pagination is-small is-rounded",role:"navigation",ariaLabel:"pagination"},hs({class:"pagination-list"},e.val.map(s=>vs(s?ws({href:"#",ariaLabel:`goto page ${s}`,class:()=>s===t.page?"pagination-link is-current":"pagination-link",onclick:t=>{t.preventDefault(),xs.page=s,r.emit("page",xs)}},s):ys({class:"pagination-ellipsis"},"â€¦"))))))},{div:As}=a.tags;let Ts=a.state(!1),Ms=a.state({filter:new e,data:new Array});function Ss(s,t=0){switch(t){case 0:Ms.val.filter=s;break;case 1:Ms.val.filter.page=s.page,Ms.val.filter.pagesize=s.pagesize}Ts.val=!0,n.transaction.getTransactions(Ms.val.filter).then(s=>{Ms.val=s,Ts.val=!1})}r.subscribe("search",s=>Ss(s)),r.subscribe("page",s=>Ss(s,1));const js=async()=>(Ms.val=await n.transaction.getTransactions(),As({class:"container mt-2"},_(),()=>Ts.val?As({class:"skeleton-block"}):As(_s({page:Ms.val.filter.page,pagesize:Ms.val.filter.pagesize,total:Ms.val.filter.pagecount}),gs({transactions:Ms.val.data}),_s({page:Ms.val.filter.page,pagesize:Ms.val.filter.pagesize,total:Ms.val.filter.pagecount}))));export{js as Transactions};
